# To-Do List (개선 계획)

## 1. 환경 (Environment)
* **[개선 필요]** `token` 설정이 두 번 되는 현상 수정.

## 2. 기능 (Features)
* **[신규 기능]** 거래량 상위 종목 조회 기능 추가.
* **[신규 기능]** 외국인 순매수 상위 종목 조회 기능 추가.
* **[신규 기능]** 전체 종목 중 거래대금 상위 10등 조회 기능 추가.
* **[신규 기능]** 웹 뷰어 생성.

## 3. 성능 (Performance)
* **[개선 필요]** 전체 종목 정보를 읽었으면 RAM에 유지하는 기능 추가 (시장이 닫혔을 경우).
* **[개선 필요]** 시장이 닫혔으면 스레드를 통해 전체 종목을 백그라운드로 업데이트하여 RAM에 올려두게 하기.
* **[최적화]** 반복적인 API 호출 최적화: `StockQueryService.handle_upper_limit_stocks`와 같이 반복적으로 개별 종목의 현재가를 조회하는 로직을 일괄 조회 또는 캐싱 전략으로 개선.

## 4. 전략 (Strategy)
* **[탐색 필요]** 다른 전략 탐색 (GPT 추천).

## 5. 테스트 (Tests)
* **[개선 필요]** 코드 커버리지 100% 달성.
* **[확장 필요]** 테스트 커버리지 확장: 모든 코드 경로와 엣지 케이스를 다루는 단위 테스트 추가.
* **[확장 필요]** 통합 테스트의 범위 확장: 실제 API 호출을 포함하는 제한된 통합 테스트 추가 (외부 API 안정성 보장 시).
* **[개선 필요]** Mock 객체의 일관성: 공통 픽스처 활용 또는 Mock 설정 유틸리티를 통해 Mock 객체 설정 중복 제거.

## 6. 코드 구조 및 모듈성 (Code Structure & Modularity)
* **[리팩토링]** `trading_app.py`의 초기화 책임 분리: `_complete_api_initialization` 내 과중한 초기화 로직을 별도의 팩토리 함수나 세분화된 단계로 분리.
* **[명확화]** `BrokerAPIWrapper`의 역할 명확화: 증권사 API 추상화에 집중하고, `KoreaInvestApiClient`는 직접적인 API 호출을 담당하도록 역할 분리.
* **[개선]** 콜백 핸들링 개선: `KoreaInvestWebSocketAPI` 내 `on_realtime_message_callback`에서 직접 `print` 문 대신 `CLIView`와 같은 UI 레이어로 메시지 전달 분리.

## 7. 오류 처리 (Error Handling)
* **[강화]** API 응답 검증 강화: `_handle_response` 및 API 응답에서 `output` 데이터의 존재 여부 및 예상 형식에 대한 명시적인 검증 추가.
* **[일관성]** 로그 메시지의 일관성: 모든 중요한 예외 상황에서 `exc_info=True`를 사용하여 스택 트레이스를 일관되게 기록.
* **[견고화]** `get_price_summary`의 데이터 누락 처리: 필수 키 누락 시 `PARSING_ERROR` 외에 경고 로깅 수준 조정 또는 기본값 제공을 통해 후속 로직 견고화.

## 8. 로깅 (Logging)
* **[관리]** 로그 파일 관리: 로그 회전(log rotation) 기능 또는 날짜별/크기별 로그 파일 관리 전략 추가.
* **[세분화]** 로그 상세 수준: `DEBUG` 레벨 로그 세분화 또는 특정 모듈에 대한 상세 로깅 제어 기능 추가.
* **[개선]** `_get_caller_info` 개선: `inspect` 모듈 활용 또는 로거 사용 시 명시적 `extra` 인자를 통해 호출 정보 전달 고려.

## 9. API 상호작용 (API Interaction)
* **[일관성]** 동기/비동기 API 호출의 일관성: 모든 API 호출을 `httpx` 기반의 비동기 방식으로 통일.
* **[세분화]** 재시도 로직의 세분화: API 응답 코드 또는 오류 유형에 따라 재시도 횟수나 지연 시간을 동적으로 조절하는 백오프(backoff) 전략 구현.
* **[캡슐화]** 토큰 관리: `TokenManager`의 `_access_token`, `_token_expired_at`에 직접 접근 대신 public getter 메서드 제공.

## 10. 코드 가독성 및 유지보수성 (Code Readability & Maintainability)
* **[강화]** 타입 힌트 강화: 모든 함수 인자 및 반환 값에 타입 힌트를 일관되게 적용하고, `Any` 타입을 구체적인 타입으로 변경.
* **[제거]** 매직 넘버/문자열 제거: 반복적으로 사용되는 상수 값들을 별도의 Enum이나 상수로 정의.
* **[전환]** `print` 문의 로거 전환: 사용자에게 정보를 표시하는 `print` 문을 `logger.info` 또는 `cli_view.display_message`와 같은 로깅/뷰 계층 메서드로 전환.