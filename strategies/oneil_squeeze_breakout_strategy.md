# 🦅 오닐식 스퀴즈 주도주 돌파매매 (V2) 실행 프로세스

본 문서는 `OneilSqueezeBreakoutStrategy` (V2)의 전체 실행 파이프라인과 매수/매도 로직을 정의합니다.

---

## 🌊 단계 1. 유니버스 수집: 3중 그물망 투망 (장중 다중 갱신)
단일 랭킹의 맹점(대형주 함정)을 피하기 위해, 시장의 모든 각도에서 후보를 끌어모읍니다.

* **갱신 주기:** 장 시작 시 최초 1회, 이후 장중 특정 시간(10분, 30분, 1시간, 1시간 30분, 3시간, 5시간 경과 시)에 추가 갱신하여 당일 새롭게 터지는 테마를 놓치지 않습니다.
* **3중 그물망:** `TradingService`를 통해 당일 **거래대금 상위 30개 + 상승률 상위 30개 + 거래량 상위 30개**를 동시에 호출하여 중복을 제거한 약 70~90개의 유니크한 원본 후보군을 생성합니다.

## 🕵️‍♂️ 단계 2. 펀더멘털 필터링 및 V2 스코어링 (워치리스트 압축)
잡주를 쳐내고 진짜 오닐식 주도주만 남기는 핵심 검증 단계입니다.

* **기본 자격 심사 (Basic Filters):**
  * 최근 5일 평균 거래대금 100억 원 이상.
  * 주가가 20일선 및 50일선 위에 있는 강력한 정배열 상태.
  * 현재가가 52주 최고가 대비 -20% 이내에 바짝 붙어있는 종목.
  * 볼린저 밴드(20일) 데이터 존재 여부.
* **V2 정밀 스코어링 (Scoring):**
  * **상대강도(RS):** 후보군 내에서 최근 3개월 수익률 상위 10%에 해당하는 종목들에게 **+30점** 부여.
  * **영업이익 성장:** 기업 재무비율 API를 호출하여 최신 영업이익 증가율이 25% 이상인 종목들에게 **+20점** 부여 (TPS 방어를 위해 청크 단위로 병렬 호출).
* **최종 압축 (Sorting):** 합산 점수(Total Score)순으로 내림차순 정렬하되, 동점자는 **'시총 대비 거래대금 회전율'이 높은 순(가볍고 돈이 많이 몰린 순)**으로 줄을 세워 최상위 15개 종목만 최종 워치리스트에 등록합니다.

## 🛡️ 단계 3. 마켓 타이밍 필터 (매수 허가증)
개별 종목이 아무리 좋아도, 폭락장에서는 방아쇠를 당기지 않습니다.

* **지수 프록시 확인:** 종목이 속한 시장(코스닥/코스피)에 맞춰, 해당 시장의 대표 ETF(KODEX 코스닥150 또는 KODEX 200)의 20일 이동평균선이 최근 3일 연속 우상향하고 있는지 1일 1회 확인합니다. 상승장이 아닐 경우 매수 시그널은 전면 거부됩니다.

## 🎯 단계 4. 실시간 매수 타점 포착 (Buy Signal)
워치리스트에 등록된 15개 종목을 3분 주기로 감시하며, 아래 4가지 조건이 **동시에(AND)** 만족되는 찰나에 진입합니다.

* **스퀴즈 (응축):** 돌파 전날의 볼린저 밴드 폭이 최근 20일 중 가장 좁았던 최저폭 대비 1.2배 이내로 에너지가 꽉 눌려 있을 것.
* **가격 돌파:** 현재가가 20일 최고가를 상향 돌파할 것.
* **거래량 돌파:** 장중 경과 시간 대비 환산된 예상 거래량이 20일 평균 거래량의 150% 이상 터질 것.
* **스마트 머니 (프로그램 필터):** 기관/외인의 개입을 증명하기 위해, 당일 프로그램 순매수가 0보다 크고, 그 금액이 당일 누적 거래대금의 10% 이상, 동시에 시가총액의 0.5% 이상일 것.

## ✂️ 단계 5. 4단계 입체 매도 (Exit Signal)
한 번 진입한 종목은 스케줄러가 장중 내내 감시하며 4가지 기준에 따라 기계적으로 청산합니다.

* **손절 (Risk Control):** 매수가 대비 -5% 하락 시 즉각 칼손절.
* **시간 손절 (Time Stop):** 돌파 후 샀는데 안 가고 5거래일 동안 횡보(박스권 변동폭 2% 미만)하면 기회비용을 위해 본전 언저리에서 청산.
* **트레일링 스탑 (Profit Run):** 추세를 타고 수익이 나기 시작하면, 매수 이후 달성한 최고가 대비 -8% 하락할 때 익절.
* **추세 이탈 (Trend Break):** 주가가 단기 생명선인 10일 이동평균선을 깨고 내려오는데, 평소 20일 평균보다 많은 대량 거래량이 동반된다면 세력 이탈로 간주하고 즉각 청산.